{
  "variables": {
    "docker_hub_user": "{{env `DOCKER_HUB_USER`}}",
    "docker_hub_pass": "{{env `DOCKER_HUB_PASS`}}",
    "box_version": "{{env `BOX_VERSION`}}"
  },
  "builders": [{
    "type": "docker",
    "image": "kalilinux/kali-linux-docker",
    "commit": true,
    "run_command": [
      "--detach",
      "--interactive",
      "--tty",
      "--entrypoint=/bin/bash",
      "{{.Image}}"
    ]
  }],
  "provisioners": [{
    "type": "shell",
    "environment_vars": [
      "CSI_PROVIDER=docker"
    ],
    "scripts": [
      "provisioners/init_image.sh",
      "provisioners/docker_rvm.sh",
      "provisioners/docker_bashrc.sh",
      "provisioners/ruby.sh",
      "provisioners/csi.sh"
    ],
    "pause_before": "1s"
  }],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "0dayinc/csi_prototyper",
        "tag": "{{user `box_version`}}"
      },
      {
        "type": "docker-push",
        "login": true,
        "login_username": "{{user `docker_hub_user`}}",
        "login_password": "{{user `docker_hub_pass`}}"
      }
    ]
  ]
}

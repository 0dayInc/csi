{
  "variables": {
    "docker_hub_user": "{{env `DOCKER_HUB_USER`}}",
    "docker_hub_pass": "{{env `DOCKER_HUB_PASS`}}",
    "box_version": "{{env `BOX_VERSION`}}"
  },
  "builders": [{
    "type": "docker",
    "image": "0dayinc/csi_prototyper:{{user `box_version`}}",
    "commit": true,
    "pull": false,
    "run_command": [ "-d", "-i", "-t", "--entrypoint=/bin/bash", "{{.Image}}" ]
  }],
  "provisioners": [{
    "type": "shell",
    "environment_vars": [
      "CSI_PROVIDER=docker"
    ],
    "scripts": [
      "provisioners/chrome.sh",
      "provisioners/firefox.sh",
      "provisioners/geckodriver.sh"
    ],
    "pause_before": "1s"
  }],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "0dayinc/csi_transparent_browser",
        "tag": "{{user `box_version`}}"
      },
      {
        "type": "docker-push",
        "login": true,
        "login_username": "{{user `docker_hub_user`}}",
        "login_password": "{{user `docker_hub_pass`}}"
      }
    ]
  ]
}

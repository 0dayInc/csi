{
  "variables": {
    "box_version": "{{env `BOX_VERSION`}}"
  },
  "builders": [{
    "type": "docker",
    "image": "csi/kali_rolling:{{user `box_version`}}",
    "commit": true,
    "pull": false,
    "run_command": [ "-d", "-i", "-t", "--entrypoint=/bin/bash", "{{.Image}}" ]
  }],
  "provisioners": [{
    "type": "shell",
    "environment_vars": [
      "CSI_PROVIDER=docker"
    ],
    "scripts": [
      "provisioners/chrome.sh",
      "provisioners/firefox.sh",
      "provisioners/geckodriver.sh"
    ],
    "pause_before": "1s"
  }],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "csi/kali_rolling/plugins/transparent_browser",
        "tag": "{{user `box_version`}}"
      }
    ]
  ]
}

#!/usr/bin/env ruby
# frozen_string_literal: true
require 'csi'
require 'pry'

begin
  cli = Pry

  cli::Commands.create_command 'toggle-pager' do
    description 'Toggle less on returned objects surpassing the terminal.'

    def process
      _pry_.config.pager = if _pry_.config.pager
                             false
                           else
                             true
                           end
    end
  end

  # Custom Main & Wait (Multi-Line) Prompts
  title = "\001\e[31m\002csi\001\e[0m\002" # Red
  version = "\001\e[36m\002v#{CSI::VERSION}\001\e[0m\002" # Cayan
  arrow = "\001\e[32m\002>>>\001\e[0m\002" # Green
  splat = "\001\e[33m\002***\001\e[0m\002" # Yellow

  prompt = [
    proc do |target_self, nest_level, pry|
      line_count = "\001\e[33m\002#{pry.input_array.size}\001\e[0m\002"
      "#{title}|#{version}|#{line_count} #{arrow} ".to_s.scrub
    end,
    proc do |target_self, nest_level, pry|
      line_count = "\001\e[33m\002#{pry.input_array.size}\001\e[0m\002"
      "#{title}|#{version}|#{line_count} #{splat} ".to_s.scrub
    end
  ]
  cli.start(self, prompt: prompt)
ensure
  if $browser
    $browser = CSI::Plugins::TransparentBrowser.close(
      browser_obj: $browser
    )
  end
end
